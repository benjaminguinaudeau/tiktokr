---
title: "lab"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

pacman::p_load(tidyverse)
```

```{r}
reticulate::use_python("/usr/local/bin/python3")
library(reticulate)
devtools::load_all()

init_tiktokr()

URLdecode("https://www.facebook.com/ajax/bulk-route-definitions/?route_urls[0]=%2Femeline.dutheil.1%3F__cft__[0]%3DAZUHVEPQrdZlms4g2U7Ulq7w6bx9dWxyfvLkUITbJoj_UGXNg1RcK02AxvlRv6UOLdwYzRbZ7KvCbbDQM6beipcy60Fb7DJN4v8CtrikWjs4vAvdlEXNHBcGuEijjGIdj33IZ6epXvvuEMo5bYulJpGZ%26__tn__%3D%253C%253C%252CP-R&route_urls[1]=%2Femeline.dutheil.1%3F__cft__[0]%3DAZUHVEPQrdZlms4g2U7Ulq7w6bx9dWxyfvLkUITbJoj_UGXNg1RcK02AxvlRv6UOLdwYzRbZ7KvCbbDQM6beipcy60Fb7DJN4v8CtrikWjs4vAvdlEXNHBcGuEijjGIdj33IZ6epXvvuEMo5bYulJpGZ%26__tn__%3D%253C%252CP-R&route_urls[2]=%2Femeline.dutheil.1%3F__cft__[0]%3DAZUHVEPQrdZlms4g2U7Ulq7w6bx9dWxyfvLkUITbJoj_UGXNg1RcK02AxvlRv6UOLdwYzRbZ7KvCbbDQM6beipcy60Fb7DJN4v8CtrikWjs4vAvdlEXNHBcGuEijjGIdj33IZ6epXvvuEMo5bYulJpGZ%26__tn__%3D-UC%252CP-R&route_urls[3]=%2Fkonbinifr%2F%3F__cft__[0]%3DAZUR8ljzuyJ-N2KshiaS28f2IwCCTyGwQzzCucgG2d73FFrpagHoqfheu122MqA-vpAcN65XPbyqwhbpcgeiTgCyZLLWwnfmTvjVC_ai_PSbPAqmWOsWx4hCcUqgXKWTtaVW_vSE_R9ogWXw9OyqhNe8RDsmawiCiw2BGj1fbIfAhtV3HK9u3fPwBNSMra-bTxInCVk6Cavjg5IUWmUuAaRc%26__tn__%3D%253C%253C%252CP-R&route_urls[4]=%2Fkonbinifr%2F%3F__cft__[0]%3DAZUR8ljzuyJ-N2KshiaS28f2IwCCTyGwQzzCucgG2d73FFrpagHoqfheu122MqA-vpAcN65XPbyqwhbpcgeiTgCyZLLWwnfmTvjVC_ai_PSbPAqmWOsWx4hCcUqgXKWTtaVW_vSE_R9ogWXw9OyqhNe8RDsmawiCiw2BGj1fbIfAhtV3HK9u3fPwBNSMra-bTxInCVk6Cavjg5IUWmUuAaRc%26__tn__%3D%253C%252CP-R&route_urls[5]=%2Fkonbinifr%2F%3F__cft__[0]%3DAZUR8ljzuyJ-N2KshiaS28f2IwCCTyGwQzzCucgG2d73FFrpagHoqfheu122MqA-vpAcN65XPbyqwhbpcgeiTgCyZLLWwnfmTvjVC_ai_PSbPAqmWOsWx4hCcUqgXKWTtaVW_vSE_R9ogWXw9OyqhNe8RDsmawiCiw2BGj1fbIfAhtV3HK9u3fPwBNSMra-bTxInCVk6Cavjg5IUWmUuAaRc%26__tn__%3D-UC%252CP-R&route_urls[6]=%2FAmazing-Tech-Crowdfunding-Projects-You-Need-To-See-499560093584960%2F%3F__cft__[0]%3DAZWh5iBL16vIFeCY-b5OzYQ51vE859Bn75gA5CR3q4AT-R_o_dqqXlnW-bBNVWrZ7GZ2MCgdUKLafC19DMiFsjT1t9fV41Q647VsJKyoA_9RaTHBH6767hUEKxhgVboN_ywRjBaq8VKC0ZMVnAOasVCHfF6ogD8TxJdwvhI-zwvW_gzKLIYrG1xikyGLYSL7rv9lbl162oh24gr_EMCkuEgoVyw9IEXn7sgLDBD_0DJFFUOA3Ny2dalyHYIjTVbBvyrAEMVdvvsroL4d5SU19sAufdtn5EvuLGUMPh4No2nPwBzRb0K7ErZSnfkRMjShnBs%26__tn__%3D%253C%253C%252CP-R&route_urls[7]=%2FAmazing-Tech-Crowdfunding-Projects-You-Need-To-See-499560093584960%2F%3F__cft__[0]%3DAZWh5iBL16vIFeCY-b5OzYQ51vE859Bn75gA5CR3q4AT-R_o_dqqXlnW-bBNVWrZ7GZ2MCgdUKLafC19DMiFsjT1t9fV41Q647VsJKyoA_9RaTHBH6767hUEKxhgVboN_ywRjBaq8VKC0ZMVnAOasVCHfF6ogD8TxJdwvhI-zwvW_gzKLIYrG1xikyGLYSL7rv9lbl162oh24gr_EMCkuEgoVyw9IEXn7sgLDBD_0DJFFUOA3Ny2dalyHYIjTVbBvyrAEMVdvvsroL4d5SU19sAufdtn5EvuLGUMPh4No2nPwBzRb0K7ErZSnfkRMjShnBs%26__tn__%3D%253C%252CP-R&route_urls[8]=%2FAmazing-Tech-Crowdfunding-Projects-You-Need-To-See-499560093584960%2F%3F__cft__[0]%3DAZWh5iBL16vIFeCY-b5OzYQ51vE859Bn75gA5CR3q4AT-R_o_dqqXlnW-bBNVWrZ7GZ2MCgdUKLafC19DMiFsjT1t9fV41Q647VsJKyoA_9RaTHBH6767hUEKxhgVboN_ywRjBaq8VKC0ZMVnAOasVCHfF6ogD8TxJdwvhI-zwvW_gzKLIYrG1xikyGLYSL7rv9lbl162oh24gr_EMCkuEgoVyw9IEXn7sgLDBD_0DJFFUOA3Ny2dalyHYIjTVbBvyrAEMVdvvsroL4d5SU19sAufdtn5EvuLGUMPh4No2nPwBzRb0K7ErZSnfkRMjShnBs%26__tn__%3D-UC%252CP-R&route_urls[9]=%2Fkonbinifr%2Fvideos%2F2567191763534527%2F%3F__cft__[0]%3DAZUR8ljzuyJ-N2KshiaS28f2IwCCTyGwQzzCucgG2d73FFrpagHoqfheu122MqA-vpAcN65XPbyqwhbpcgeiTgCyZLLWwnfmTvjVC_ai_PSbPAqmWOsWx4hCcUqgXKWTtaVW_vSE_R9ogWXw9OyqhNe8RDsmawiCiw2BGj1fbIfAhtV3HK9u3fPwBNSMra-bTxInCVk6Cavjg5IUWmUuAaRc%26__tn__%3D%252B%253FFH-R&__user=1407371963&__a=1&__dyn=7AzHK4HwBgC265Q2m3m8GEnxenFw9uu2i5U4e1NxtoK3q322aewXwnEboG4E6icwJwpUe8hw8u1_w5nCxS320LE36xOfwwwto88hwKx-8wgolzUOm0Z84a3aUS2G2CaCzU7W8wnolwBgK7qwpE31wLxG4UaoC9xy48aU8od8-Uqxy1qxi4UaEW1-xS6FobrwKxm5oe8aUarw&__csr=&__req=1m&__beoa=1&__pc=EXP1%3Acomet_pkg&dpr=2&__ccg=EXCELLENT&__rev=1002216705&__s=x90kgt%3Ajdz1wc%3A7utdqn&__hsi=6836049135264818166-0&__comet_req=1&fb_dtsg_ag=AQxgNl__LSaXJyqv0qLYodBpF4H2oInWscTcxV27H3unrw%3AAQwEXL3wIOtelAs_xLY2Hgg91NAhq7GCLAjlI789NeK3Yw&jazoest=28005&__spin_r=1002216705&__spin_b=trunk&__spin_t=1591641720")

```


```{r}
test_req <- c()

if(length(test_req$content) == 0){do_something}

hash_post <- get_hashtag_post(count = 100000000, hashtag = "coronavirus", save = T, path = "video")
hash_post <- get_hashtag_post(count = 400, hashtag = "plandemic")


video <- hash_post[50,]

download_video(video$playUrl)



hash_post %>%
    head(100) %>%
    glimpse

hash_post %>%
    count(id)
    filter(id == "6823804732973337862") %>%
    select_if(~length(unique(.x))  > 1) %>%
    .[[1]]
    pull(url)

```


```{r}
trends <- get_trending(10)

urls <- trends$downloadAddr
url <- urls[1]





 #     b = browser(download_url)
    #     return self.getBytes(download_url, b.signature, b.userAgent)
```


```{r}
 # def getBytes(self, api_url, signature, userAgent):
 #        url = api_url + \
 #            "&_signature=" + signature
 #        r = requests.get(url, headers={"method": "GET",
 #                                       "accept-encoding": "gzip, deflate, br",
 #                                       "referrer": self.referrer,
 #                                       "user-agent": userAgent,
 #                                       })
 #        return r.content

    # def get_Video_By_TikTok(self, data):
    #     api_url = data['video']['downloadAddr']
    #     return self.get_Video_By_DownloadURL(api_url)
    # 
    # #
    # # Downloads video from TikTok using download url in a tiktok object
    # #

    # def get_Video_By_DownloadURL(self, download_url):
    #     b = browser(download_url)
    #     return self.getBytes(download_url, b.signature, b.userAgent)
    # 
    # #
    # # Gets the source url of a given url for a tiktok
    # #
    # # video_url - the url of the video
    # # return_bytes - 0 is just the url, 1 is the actual video bytes
    # # chromedriver_path - path to your chrome driver executible
    # #


    # def get_Video_By_Url(self, video_url, return_bytes=0, chromedriver_path=None):
    #     if chromedriver_path != None:
    #         driver = webdriver.Chrome(executable_path=chromedriver_path)
    #     else:
    #         driver = webdriver.Chrome()
    #     driver.get(video_url)
    #     time.sleep(5)
    # 
    #     soup = BeautifulSoup(driver.page_source, 'html.parser')
    #     data = json.loads(soup.find_all(
    #         'script', attrs={"id": "videoObject"})[0].text)
    # 
    #     if return_bytes == 0:
    #         return data['contentUrl']
    #     else:
    #         r = requests.get(data['contentUrl'])
    #         return r.content
```





```{r}
library(dockeR)

prune_containers()

# First Container
chrome <- docker$new(
  image_src = "selenium/standalone-chrome-debug", #Image to be used (model for the container)
  container_name = "chrome",
  other_arguments = "-p 4446:4444 -p 4447:5900"
  
  # Name you want to use
)
```

```{r}
list_container() %>%
  dplyr::glimpse()
```


```{r}
# chrome %>% get_port(filter_port = c(4444, 5900))

library(tidyselenium)
library(dockeR)



chrome <- chrome_init(cache = "tiktokr")

```


