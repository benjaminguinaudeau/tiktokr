---
title: "lab"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

pacman::p_load(tidyverse)
```

```{r}
reticulate::use_python("/usr/local/bin/python3")
library(reticulate)
devtools::load_all()

init_tiktokr()

get_user_post(username =  ".rebemb", 200)
hash_post <- get_hashtag_post(hashtag = "maincharacter", 200)

hash_post
out

parse_json_structure <- function(x){
  if(is.null(x)){return(tibble::tibble())}
  x %>%
    dplyr::select_if(is.data.frame) %>%
    purrr::map_dfc(~{
      if(!any(purrr::map_lgl(.x, is.data.frame))){return(.x)}
      parse_json_structure(.x)
    }) %>%
    dplyr::bind_cols(dplyr::select_if(x, ~!is.data.frame(.x)))
}
names(x)

```


```{r}
test_req <- c()

if(length(test_req$content) == 0){do_something}

hash_post <- get_hashtag_post(count = 100000000, hashtag = "coronavirus", save = T, path = "video")
hash_post <- get_hashtag_post(count = 400, hashtag = "plandemic")


video <- hash_post[50,]

download_video(video$playUrl)



hash_post %>%
    head(100) %>%
    glimpse

hash_post %>%
    count(id)
    filter(id == "6823804732973337862") %>%
    select_if(~length(unique(.x))  > 1) %>%
    .[[1]]
    pull(url)

```


```{r}
trends <- get_trending(10)

urls <- trends$downloadAddr
url <- urls[1]





 #     b = browser(download_url)
    #     return self.getBytes(download_url, b.signature, b.userAgent)
```


```{r}
 # def getBytes(self, api_url, signature, userAgent):
 #        url = api_url + \
 #            "&_signature=" + signature
 #        r = requests.get(url, headers={"method": "GET",
 #                                       "accept-encoding": "gzip, deflate, br",
 #                                       "referrer": self.referrer,
 #                                       "user-agent": userAgent,
 #                                       })
 #        return r.content

    # def get_Video_By_TikTok(self, data):
    #     api_url = data['video']['downloadAddr']
    #     return self.get_Video_By_DownloadURL(api_url)
    # 
    # #
    # # Downloads video from TikTok using download url in a tiktok object
    # #

    # def get_Video_By_DownloadURL(self, download_url):
    #     b = browser(download_url)
    #     return self.getBytes(download_url, b.signature, b.userAgent)
    # 
    # #
    # # Gets the source url of a given url for a tiktok
    # #
    # # video_url - the url of the video
    # # return_bytes - 0 is just the url, 1 is the actual video bytes
    # # chromedriver_path - path to your chrome driver executible
    # #


    # def get_Video_By_Url(self, video_url, return_bytes=0, chromedriver_path=None):
    #     if chromedriver_path != None:
    #         driver = webdriver.Chrome(executable_path=chromedriver_path)
    #     else:
    #         driver = webdriver.Chrome()
    #     driver.get(video_url)
    #     time.sleep(5)
    # 
    #     soup = BeautifulSoup(driver.page_source, 'html.parser')
    #     data = json.loads(soup.find_all(
    #         'script', attrs={"id": "videoObject"})[0].text)
    # 
    #     if return_bytes == 0:
    #         return data['contentUrl']
    #     else:
    #         r = requests.get(data['contentUrl'])
    #         return r.content
```





```{r}
library(dockeR)

prune_containers()

# First Container
chrome <- docker$new(
  image_src = "selenium/standalone-chrome-debug", #Image to be used (model for the container)
  container_name = "chrome",
  other_arguments = "-p 4446:4444 -p 4447:5900"
  
  # Name you want to use
)
```

```{r}
list_container() %>%
  dplyr::glimpse()
```


```{r}
# chrome %>% get_port(filter_port = c(4444, 5900))

library(tidyselenium)
library(dockeR)



chrome <- chrome_init(cache = "tiktokr")

```


